<!DOCTYPE html>
<html lang="en" id="html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1,minimum-scale=0.5">
    <title>给好友送折扣</title>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="../css/present.css">
</head>
<body>
<header>
    <image src="../images/present_head.png" style="width:100%"></image>
</header>
<section>
    <input type="number" id="phone"  placeholder="请输入手机号" onkeyup="inputphone()" oninput="if(value.length>11)value=value.slice(0,11)">
    <div class="free" id="free" onclick="send()">
        <span>免费领取</span>
    </div>
    <p>下载士哆便利</p>
</section>
<div class="line"></div>
<footer>
    <p>长按识别二维码</p>
    <img src="../images/code.png">
    <p>关注微信</p>
    <p>了解更多新鲜福利</p>
</footer>
<div class="motai">
    <div class="content">
        <p>你已经是士哆便利会</p>
        <p>员了，快去使用优惠卷吧！</p>
        <span onclick="openapp()">去使用</span>
    </div>
</div>
</body>
<script>
    //获取设备屏幕宽度,设置根目录宽度和字体大小
    function screenwidth(){
        var html = document.getElementById('html');
        /*html.style.fontSize = window.screen.width+'px';*/
        var w=document.documentElement?document.documentElement.clientWidth :document.body.clientWidth ;
        html.style.fontSize = w/7.5 +'px';
    }
    screenwidth();
    //获取域名,解析
    function reset(){
        var r = window.location.search.substr(1).split('&');
        var first = r[0].split('=')[1];
        return first;
    }
    var firstphone = reset();
    //判断电话
    function checkphone(data){
        if(!(/^1(3|4|5|7|8)\d{9}$/.test(data))){
            console.log('错误的电话号码');
            return false;
        }else{
            console.log('对的电话号码');
            return true;
        }
    }
    var flag = false;
    var myphone = '';
    function inputphone(){
        var phone = document.getElementById('phone');
        myphone = phone.value;
        flag = checkphone(myphone);
        if(flag == true){
            var free = document.getElementById('free');
            free.style.background = '#ff3a35'
        }else if(flag == false){
            var free = document.getElementById('free');
            free.style.background = 'rgb(222,220,221)';
        }
    }
    //发送手机号到后台
    function send(){
        if(flag == true){
            alert(firstphone+'and'+myphone);
            $.post('/path/to/file', {param1: 'value1'}, function(data, textStatus, xhr) {
                /*optional stuff to do after success */
            });
        }else{
            alert('失败');
        }
    }
    //打开app
    function openapp(){
        //判断用户移动端使用的系统平台
        var u = navigator.userAgent;
        if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {
            //安卓手机
            console.log('安卓手机');
            if(isWeiXin()){
                alert('微信浏览器');
            }else{
                alert('其他浏览器');
            }
        } else if (u.indexOf('iPhone') > -1) {
            //苹果手机
            console.log('苹果手机');
            window.location.href ='storeberry://';
            setTimeout(function () {
                    window.location.href = "www.baidu.com";
            }, 200);
        } else if (u.indexOf('Windows Phone') > -1) {
            //winphone手机
        }
    }
    //是否微信
    function isWeiXin(){
        var ua = window.navigator.userAgent.toLowerCase();
        if(ua.match(/MicroMessenger/i) == 'micromessenger'){
            return true;
        }else{
            return false;
        }
    }
</script>
</html>
